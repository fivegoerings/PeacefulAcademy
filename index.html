<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peaceful Fields Academy — Homeschool Tracker</title>
  <!-- Tailwind CSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Peaceful Fields Academy (Kansas City, Missouri). Track homeschool courses, hours, and student work samples.">
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <!-- React + ReactDOM (ESM) -->
  <script type="module">
    import React, { useEffect, useMemo, useRef, useState } from "https://esm.sh/react@18.3.1";
    import { createRoot } from "https://esm.sh/react-dom@18.3.1/client";
    import * as lucide from "https://esm.sh/lucide-react@0.460.0";

    const { Download, FileDown, Upload, Layers, LayoutDashboard, Plus, Printer, Save, School, Settings, User, BookOpen, Clock, Images, FolderOpen, Trash2, Edit2, X, Search } = lucide;

    const STORAGE_KEY = "pfa_homeschool_tracker_v1";

    function uid(prefix = "id") { return `${prefix}_${Math.random().toString(36).slice(2, 10)}_${Date.now()}`; }
    function saveToLocal(data) { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
    function loadFromLocal() { try { const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; } catch { return null; } }
    function classNames(...arr) { return arr.filter(Boolean).join(" "); }
    function formatMinutes(mins) { const h = Math.floor(mins / 60); const m = mins % 60; return `${h}h ${m}m`; }
    function downloadFile(filename, text) {
      const a = document.createElement("a");
      a.href = URL.createObjectURL(new Blob([text], { type: "application/json" }));
      a.download = filename; document.body.appendChild(a); a.click(); a.remove();
    }
    function toCSV(rows) {
      if (!rows || !rows.length) return "";
      const headers = Object.keys(rows[0]);
      const esc = v => `"${String(v ?? "").replaceAll('"','""')}"`;
      return [headers.join(",")].concat(rows.map(r => headers.map(h => esc(r[h])).join(","))).join("\n");
    }

    const defaultState = {
      meta: {
        academyName: "Peaceful Fields Academy",
        location: "Kansas City, Missouri",
        schoolYearLabel: new Date().getFullYear() + "–" + (new Date().getFullYear() + 1),
        yearStart: new Date(new Date().getFullYear(), 7, 1).toISOString(),
        goals: { total: 1000 * 60, core: 600 * 60, atHome: 400 * 60 },
        notes: "Goals reflect common Missouri guidance; adjust as needed.",
      },
      students: [],
      courses: [],
      hours: [],
      samples: [],
    };

    const Card = ({ children, className }) => React.createElement("div", { className: classNames("bg-white rounded-2xl shadow-sm border border-gray-200 p-4", className) }, children);
    const SectionTitle = ({ icon: Icon, title, subtitle, right }) => (
      React.createElement("div", { className: "flex items-start justify-between gap-4 mb-4" },
        React.createElement("div", null,
          React.createElement("div", { className: "flex items-center gap-2" }, Icon && React.createElement(Icon, { className: "w-5 h-5" }), React.createElement("h2", { className: "text-xl font-semibold" }, title)),
          subtitle && React.createElement("p", { className: "text-sm text-gray-600 mt-1" }, subtitle)
        ),
        right
      )
    );
    const Badge = ({ children }) => React.createElement("span", { className: "inline-flex items-center px-2 py-0.5 text-xs rounded-full bg-gray-100 border border-gray-200" }, children);
    const Input = props => React.createElement("input", { ...props, className: classNames("w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring", props.className) });
    const Select = props => React.createElement("select", { ...props, className: classNames("w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring", props.className) });
    const Textarea = props => React.createElement("textarea", { ...props, className: classNames("w-full border rounded-xl px-3 py-2 focus:outline-none focus:ring", props.className) });
    const Button = ({ children, className, variant = "primary", ...rest }) => {
      const base = "inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium border transition";
      const styles = { primary: "bg-blue-600 text-white border-blue-700 hover:bg-blue-700", ghost: "bg-white text-gray-800 border-gray-300 hover:bg-gray-50", danger: "bg-red-600 text-white border-red-700 hover:bg-red-700" };
      return React.createElement("button", { className: classNames(base, styles[variant], className), ...rest }, children);
    };
    const Modal = ({ open, onClose, title, children, maxWidth = "max-w-3xl" }) => {
      if (!open) return null;
      return (
        React.createElement("div", { className: "fixed inset-0 z-50 flex items-center justify-center p-4" },
          React.createElement("div", { className: "absolute inset-0 bg-black/40", onClick: onClose }),
          React.createElement("div", { className: classNames("relative z-10 w-full", maxWidth) },
            React.createElement(Card, { className: "p-6" },
              React.createElement("div", { className: "flex items-start justify-between" },
                React.createElement("h3", { className: "text-lg font-semibold" }, title),
                React.createElement("button", { onClick: onClose, className: "p-1 rounded hover:bg-gray-100" }, React.createElement(X, { className: "w-5 h-5" }))
              ),
              React.createElement("div", { className: "mt-4" }, children)
            )
          )
        )
      );
    };

    function usePersistentState() {
      const [state, setState] = useState(() => loadFromLocal() || defaultState);
      useEffect(() => { saveToLocal(state); }, [state]);
      return [state, setState];
    }
    function useGoalsProgress(state, activeStudentId, activeYearStartISO) {
      const start = useMemo(() => new Date(activeYearStartISO), [activeYearStartISO]);
      const end = useMemo(() => new Date(start.getFullYear() + 1, start.getMonth(), start.getDate()), [start]);
      const logs = state.hours.filter(h => { const d = new Date(h.date); return d >= start && d < end && (!activeStudentId || h.studentId === activeStudentId); });
      const total = logs.reduce((s, h) => s + (Number(h.minutes) || 0), 0);
      const core = logs.filter(h => h.isCore).reduce((s, h) => s + (Number(h.minutes) || 0), 0);
      const atHome = logs.filter(h => h.location === "Home").reduce((s, h) => s + (Number(h.minutes) || 0), 0);
      return { total, core, atHome, periodStart: start, periodEnd: end };
    }
    function ProgressBar({ value, max, label }) {
      const pct = Math.min(100, Math.round((value / (max || 1)) * 100));
      return (
        React.createElement("div", null,
          React.createElement("div", { className: "flex justify-between text-sm mb-1" }, React.createElement("span", null, label), React.createElement("span", null, pct + "%")),
          React.createElement("div", { className: "w-full h-3 bg-gray-100 rounded-xl overflow-hidden" },
            React.createElement("div", { className: "h-3 bg-blue-600", style: { width: pct + "%" } })
          ),
          React.createElement("div", { className: "text-xs text-gray-600 mt-1" }, `${formatMinutes(value)} of ${formatMinutes(max)} (${(max/60)|0}h goal)`)
        )
      );
    }
    function Row({ children, className }) { return React.createElement("div", { className: classNames("grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3", className) }, children); }
    const EmptyState = ({ icon: Icon, title, children, action }) => (
      React.createElement(Card, { className: "text-center py-12" },
        React.createElement(Icon, { className: "w-10 h-10 mx-auto mb-3" }),
        React.createElement("h3", { className: "text-lg font-semibold" }, title),
        React.createElement("p", { className: "text-gray-600 mt-1" }, children),
        action && React.createElement("div", { className: "mt-4" }, action)
      )
    );

    function SideTab({ icon: Icon, label, value, tab, setTab }) {
      const active = tab === value;
      return React.createElement("button", { onClick: () => setTab(value), className: classNames("w-full text-left px-3 py-2 rounded-xl flex items-center gap-2", active ? "bg-blue-50 text-blue-700" : "hover:bg-gray-50") },
        React.createElement(Icon, { className: "w-4 h-4" }),
        React.createElement("span", { className: "text-sm" }, label)
      );
    }

    function Dashboard({ state, goalsProgress, students, courses, setTab }) {
      const { total, core, atHome } = goalsProgress;
      const goals = state.meta.goals;
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: LayoutDashboard, title: "Dashboard", subtitle: "Missouri-style hour tracking at a glance.", right: React.createElement(Button, { variant: "ghost", onClick: () => setTab("hours") }, React.createElement(Plus, { className: "w-4 h-4" }), "Quick Log") }),
        React.createElement(Row, null,
          React.createElement(Card, null,
            React.createElement("h3", { className: "font-semibold mb-3" }, "Yearly Progress"),
            React.createElement("div", { className: "space-y-3" },
              React.createElement(ProgressBar, { value: total, max: goals.total, label: "Total Hours" }),
              React.createElement(ProgressBar, { value: core, max: goals.core, label: "Core (Reading/Math/Language/Science/Social Studies)" }),
              React.createElement(ProgressBar, { value: atHome, max: goals.atHome, label: "At Home Location" })
            )
          ),
          React.createElement(Card, null,
            React.createElement("h3", { className: "font-semibold mb-3" }, "Students"),
            students.length === 0 ? React.createElement("p", { className: "text-gray-600 text-sm" }, "No students yet. Add one in the Students tab.")
            : React.createElement("ul", { className: "space-y-2" },
                students.map(s => React.createElement("li", { key: s.id, className: "flex items-center justify-between" },
                  React.createElement("div", null, React.createElement("div", { className: "font-medium" }, s.name), React.createElement("div", { className: "text-xs text-gray-600" }, "Grade ", s.grade || "—")),
                  React.createElement(Badge, null, "Portfolio Ready")
                ))
              )
          ),
          React.createElement(Card, null,
            React.createElement("h3", { className: "font-semibold mb-3" }, "Courses"),
            courses.length === 0 ? React.createElement("p", { className: "text-gray-600 text-sm" }, "No courses yet. Add them in the Courses tab.")
            : React.createElement("ul", { className: "grid grid-cols-1 sm:grid-cols-2 gap-2" },
                courses.map(c => React.createElement("li", { key: c.id, className: "border rounded-xl px-3 py-2" },
                  React.createElement("div", { className: "font-medium" }, c.title),
                  React.createElement("div", { className: "text-xs text-gray-600" }, c.category || "—")
                ))
              )
          )
        ),
        React.createElement(Card, null,
          React.createElement("h3", { className: "font-semibold mb-3" }, "Quick Guidance for Missouri Recordkeeping"),
          React.createElement("ul", { className: "list-disc pl-5 text-sm text-gray-700 space-y-1" },
            React.createElement("li", null, "Keep a daily log of hours by subject. Mark whether hours are Core or Elective and whether they occurred at Home or Off-site."),
            React.createElement("li", null, "Maintain samples of student work. Upload photos/PDFs and link them to a course and date."),
            React.createElement("li", null, "Set annual goals in ", React.createElement("em", null, "Settings"), " (defaults provided). This app calculates progress automatically.")
          ),
          React.createElement("p", { className: "text-xs text-gray-500 mt-2" }, "Note: Requirements can vary; confirm details with Missouri statutes and your district’s interpretation. This tool is configurable to fit your approach.")
        )
      );
    }

    function StudentsTab({ students, addStudent, updateStudent, deleteStudent, setActiveStudentId }) {
      const [modalOpen, setModalOpen] = useState(false);
      const [form, setForm] = useState({ name: "", grade: "", dob: "" });
      function submit() { if (!form.name.trim()) return; addStudent(form); setForm({ name: "", grade: "", dob: "" }); setModalOpen(false); }
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: User, title: "Students", subtitle: "Add each enrolled child.", right: React.createElement(Button, { onClick: () => setModalOpen(true) }, React.createElement(Plus, { className: "w-4 h-4" }), " Add Student") }),
        students.length === 0 ? React.createElement(EmptyState, { icon: User, title: "No students yet" }, "Create your first student profile to begin tracking.")
        : React.createElement(Card, null,
            React.createElement("div", { className: "overflow-x-auto" },
              React.createElement("table", { className: "w-full text-sm" },
                React.createElement("thead", null, React.createElement("tr", { className: "text-left border-b" }, React.createElement("th", { className: "py-2" }, "Name"), React.createElement("th", null, "Grade"), React.createElement("th", null, "DOB"), React.createElement("th", { className: "w-40" }, "Actions"))),
                React.createElement("tbody", null,
                  students.map(s => React.createElement("tr", { key: s.id, className: "border-b last:border-none" },
                    React.createElement("td", { className: "py-2 font-medium" }, s.name),
                    React.createElement("td", null, s.grade || "—"),
                    React.createElement("td", null, s.dob || "—"),
                    React.createElement("td", null, React.createElement("div", { className: "flex gap-2" },
                      React.createElement(Button, { variant: "ghost", onClick: () => setActiveStudentId(s.id) }, React.createElement(School, { className: "w-4 h-4" }), " Focus"),
                      React.createElement(Button, { variant: "ghost", onClick: () => updateStudent(s.id, { editing: true }) }, React.createElement(Edit2, { className: "w-4 h-4" }), " Edit"),
                      React.createElement(Button, { variant: "danger", onClick: () => deleteStudent(s.id) }, React.createElement(Trash2, { className: "w-4 h-4" }), " Delete")
                    ))))))))
        ,
        React.createElement(Modal, { open: modalOpen, onClose: () => setModalOpen(false), title: "Add Student" },
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Full Name"), React.createElement(Input, { value: form.name, onChange: e => setForm({ ...form, name: e.target.value }), placeholder: "Student name" })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Grade"), React.createElement(Input, { value: form.grade, onChange: e => setForm({ ...form, grade: e.target.value }), placeholder: "e.g., 9" })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Date of Birth"), React.createElement(Input, { type: "date", value: form.dob, onChange: e => setForm({ ...form, dob: e.target.value }) }))
          ),
          React.createElement("div", { className: "mt-4 flex justify-end" }, React.createElement(Button, { onClick: submit }, React.createElement(Plus, { className: "w-4 h-4" }), " Add"))
        )
      );
    }

    function CoursesTab({ courses, addCourse, updateCourse, deleteCourse }) {
      const [modalOpen, setModalOpen] = useState(false);
      const [form, setForm] = useState({ title: "", category: "Core", notes: "" });
      function submit() { if (!form.title.trim()) return; addCourse(form); setForm({ title: "", category: "Core", notes: "" }); setModalOpen(false); }
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: BookOpen, title: "Courses", subtitle: "Subjects to log hours against.", right: React.createElement(Button, { onClick: () => setModalOpen(true) }, React.createElement(Plus, { className: "w-4 h-4" }), " Add Course") }),
        courses.length === 0 ? React.createElement(EmptyState, { icon: BookOpen, title: "No courses yet" }, "Add Math, English, Science, Social Studies, PE, Fine Arts, etc.")
        : React.createElement(Card, null,
            React.createElement("div", { className: "overflow-x-auto" },
              React.createElement("table", { className: "w-full text-sm" },
                React.createElement("thead", null, React.createElement("tr", { className: "text-left border-b" }, React.createElement("th", { className: "py-2" }, "Title"), React.createElement("th", null, "Category"), React.createElement("th", null, "Notes"), React.createElement("th", { className: "w-40" }, "Actions"))),
                React.createElement("tbody", null,
                  courses.map(c => React.createElement("tr", { key: c.id, className: "border-b last:border-none" },
                    React.createElement("td", { className: "py-2 font-medium" }, c.title),
                    React.createElement("td", null, c.category || "—"),
                    React.createElement("td", { className: "max-w-[420px] truncate", title: c.notes }, c.notes || "—"),
                    React.createElement("td", null, React.createElement("div", { className: "flex gap-2" },
                      React.createElement(Button, { variant: "ghost", onClick: () => updateCourse(c.id, { category: c.category === "Core" ? "Elective" : "Core" }) }, React.createElement(Layers, { className: "w-4 h-4" }), " Toggle"),
                      React.createElement(Button, { variant: "ghost", onClick: () => updateCourse(c.id, { editing: true }) }, React.createElement(Edit2, { className: "w-4 h-4" }), " Edit"),
                      React.createElement(Button, { variant: "danger", onClick: () => deleteCourse(c.id) }, React.createElement(Trash2, { className: "w-4 h-4" }), " Delete")
                    ))
                  ))
              )
            )
          )
        ,
        React.createElement(Modal, { open: modalOpen, onClose: () => setModalOpen(false), title: "Add Course" },
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Title"), React.createElement(Input, { value: form.title, onChange: e => setForm({ ...form, title: e.target.value }), placeholder: "e.g., Algebra I" })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Category"), React.createElement(Select, { value: form.category, onChange: e => setForm({ ...form, category: e.target.value }) }, React.createElement("option", null, "Core"), React.createElement("option", null, "Elective"))),
            React.createElement("div", { className: "md:col-span-2" }, React.createElement("label", { className: "text-sm" }, "Notes/Curriculum"), React.createElement(Textarea, { rows: 3, value: form.notes, onChange: e => setForm({ ...form, notes: e.target.value }), placeholder: "Textbook, provider, scope…" }))
          ),
          React.createElement("div", { className: "mt-4 flex justify-end" }, React.createElement(Button, { onClick: submit }, React.createElement(Plus, { className: "w-4 h-4" }), " Add"))
        )
      );
    }

    function HoursTab({ state, addHour, updateHour, deleteHour, students, courses, exportHoursCSV }) {
      const [modalOpen, setModalOpen] = useState(false);
      const [form, setForm] = useState({ studentId: "", courseId: "", date: new Date().toISOString().slice(0,10), minutes: 60, isCore: true, location: "Home", notes: "" });
      const [query, setQuery] = useState("");
      useEffect(() => { if (!form.studentId && students[0]) setForm(f => ({ ...f, studentId: students[0].id })); if (!form.courseId && courses[0]) setForm(f => ({ ...f, courseId: courses[0].id })); }, [students, courses]);
      function submit() { if (!form.studentId || !form.courseId || !form.date || !form.minutes) return; addHour({ ...form, minutes: Number(form.minutes) }); setModalOpen(false); }
      const rows = state.hours.filter(h => { const match = query.toLowerCase(); const stu = (students.find(s => s.id === h.studentId)?.name || "").toLowerCase(); const cou = (courses.find(c => c.id === h.courseId)?.title || "").toLowerCase(); return !match || stu.includes(match) || cou.includes(match) || (h.notes||"").toLowerCase().includes(match); }).sort((a,b) => new Date(b.date) - new Date(a.date));
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: Clock, title: "Log Hours", subtitle: "Daily minutes by subject.", right: React.createElement(Button, { onClick: () => setModalOpen(true) }, React.createElement(Plus, { className: "w-4 h-4" }), " Add Entry") }),
        React.createElement(Card, null,
          React.createElement("div", { className: "flex items-center gap-2 mb-3" },
            React.createElement("div", { className: "relative flex-1" },
              React.createElement(Search, { className: "w-4 h-4 absolute left-3 top-2.5 text-gray-400" }),
              React.createElement(Input, { placeholder: "Search notes, student, course", value: query, onChange: e => setQuery(e.target.value), className: "pl-8" })
            ),
            React.createElement(Button, { variant: "ghost", onClick: exportHoursCSV }, React.createElement(FileDown, { className: "w-4 h-4" }), " Export CSV")
          ),
          React.createElement("div", { className: "overflow-x-auto" },
            React.createElement("table", { className: "w-full text-sm" },
              React.createElement("thead", null, React.createElement("tr", { className: "text-left border-b" },
                React.createElement("th", { className: "py-2" }, "Date"),
                React.createElement("th", null, "Student"),
                React.createElement("th", null, "Course"),
                React.createElement("th", null, "Minutes"),
                React.createElement("th", null, "Core"),
                React.createElement("th", null, "Location"),
                React.createElement("th", null, "Notes"),
                React.createElement("th", { className: "w-40" }, "Actions")
              )),
              React.createElement("tbody", null,
                rows.map(h => React.createElement("tr", { key: h.id, className: "border-b last:border-none" },
                  React.createElement("td", { className: "py-2" }, h.date),
                  React.createElement("td", null, (students.find(s => s.id === h.studentId)?.name || "—")),
                  React.createElement("td", null, (courses.find(c => c.id === h.courseId)?.title || "—")),
                  React.createElement("td", null, h.minutes),
                  React.createElement("td", null, h.isCore ? "Yes" : "No"),
                  React.createElement("td", null, h.location),
                  React.createElement("td", { className: "max-w-[360px] truncate", title: h.notes }, h.notes || "—"),
                  React.createElement("td", null, React.createElement("div", { className: "flex gap-2" },
                    React.createElement(Button, { variant: "ghost", onClick: () => updateHour(h.id, { editing: true }) }, React.createElement(Edit2, { className: "w-4 h-4" }), " Edit"),
                    React.createElement(Button, { variant: "danger", onClick: () => deleteHour(h.id) }, React.createElement(Trash2, { className: "w-4 h-4" }), " Delete")
                  ))
                )),
                rows.length === 0 && React.createElement("tr", null, React.createElement("td", { colSpan: 8, className: "text-center text-gray-600 py-6" }, "No entries yet."))
              )
            )
          )
        ),
        React.createElement(Modal, { open: modalOpen, onClose: () => setModalOpen(false), title: "Add Hours Entry" },
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Student"), React.createElement(Select, { value: form.studentId, onChange: e => setForm({ ...form, studentId: e.target.value }) }, students.map(s => React.createElement("option", { key: s.id, value: s.id }, s.name)))),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Course"), React.createElement(Select, { value: form.courseId, onChange: e => setForm({ ...form, courseId: e.target.value }) }, courses.map(c => React.createElement("option", { key: c.id, value: c.id }, c.title)))),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Date"), React.createElement(Input, { type: "date", value: form.date, onChange: e => setForm({ ...form, date: e.target.value }) })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Minutes"), React.createElement(Input, { type: "number", min: 1, step: 5, value: form.minutes, onChange: e => setForm({ ...form, minutes: e.target.value }) })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Category"), React.createElement(Select, { value: form.isCore ? "Core" : "Elective", onChange: e => setForm({ ...form, isCore: e.target.value === "Core" }) }, React.createElement("option", null, "Core"), React.createElement("option", null, "Elective"))),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Location"), React.createElement(Select, { value: form.location, onChange: e => setForm({ ...form, location: e.target.value }) }, React.createElement("option", null, "Home"), React.createElement("option", null, "Off-site"))),
            React.createElement("div", { className: "md:col-span-2" }, React.createElement("label", { className: "text-sm" }, "Notes"), React.createElement(Textarea, { rows: 3, value: form.notes, onChange: e => setForm({ ...form, notes: e.target.value }), placeholder: "Lesson, activity, materials…" }))
          ),
          React.createElement("div", { className: "mt-4 flex justify-end" }, React.createElement(Button, { onClick: submit }, React.createElement(Plus, { className: "w-4 h-4" }), " Save Entry"))
        )
      );
    }

    function SamplesTab({ state, addSample, updateSample, deleteSample, students, courses, exportSamplesCSV }) {
      const [modalOpen, setModalOpen] = useState(false);
      const [form, setForm] = useState({ studentId: students[0]?.id || "", courseId: courses[0]?.id || "", date: new Date().toISOString().slice(0,10), title: "", notes: "", fileName: "", fileUrl: "" });
      const fileInputRef = React.useRef(null);
      const [query, setQuery] = useState("");
      function onFile(e) { const f = e.target.files?.[0]; if (!f) return; const url = URL.createObjectURL(f); setForm(prev => ({ ...prev, fileName: f.name, fileUrl: url })); }
      function submit() { if (!form.studentId || !form.courseId || !form.title) return; addSample(form); setModalOpen(false); setForm({ studentId: students[0]?.id || "", courseId: courses[0]?.id || "", date: new Date().toISOString().slice(0,10), title: "", notes: "", fileName: "", fileUrl: "" }); if (fileInputRef.current) fileInputRef.current.value = ""; }
      const rows = state.samples.filter(a => { const match = query.toLowerCase(); const stu = (students.find(s => s.id === a.studentId)?.name || "").toLowerCase(); const cou = (courses.find(c => c.id === a.courseId)?.title || "").toLowerCase(); return !match || stu.includes(match) || cou.includes(match) || (a.title||"").toLowerCase().includes(match) || (a.notes||"").toLowerCase().includes(match); }).sort((a,b) => new Date(b.date) - new Date(a.date));
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: Images, title: "Work Samples", subtitle: "Store evidence of learning.", right: React.createElement(Button, { onClick: () => setModalOpen(true) }, React.createElement(Plus, { className: "w-4 h-4" }), " Add Sample") }),
        React.createElement(Card, null,
          React.createElement("div", { className: "flex items-center gap-2 mb-3" },
            React.createElement("div", { className: "relative flex-1" },
              React.createElement(Search, { className: "w-4 h-4 absolute left-3 top-2.5 text-gray-400" }),
              React.createElement(Input, { placeholder: "Search title, notes, student, course", value: query, onChange: e => setQuery(e.target.value), className: "pl-8" })
            ),
            React.createElement(Button, { variant: "ghost", onClick: exportSamplesCSV }, React.createElement(FileDown, { className: "w-4 h-4" }), " Export CSV")
          ),
          rows.length === 0 ? React.createElement("div", { className: "text-center text-gray-600 py-6" }, "No samples yet.")
          : React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3" },
              rows.map(a => React.createElement("div", { key: a.id, className: "border rounded-2xl overflow-hidden bg-white" },
                a.fileUrl ? React.createElement("a", { href: a.fileUrl, target: "_blank", rel: "noreferrer" }, React.createElement("img", { src: a.fileUrl, alt: a.title, className: "w-full h-40 object-cover" }))
                          : React.createElement("div", { className: "w-full h-40 grid place-content-center text-gray-400" }, "No Preview"),
                React.createElement("div", { className: "p-3" },
                  React.createElement("div", { className: "font-medium" }, a.title),
                  React.createElement("div", { className: "text-xs text-gray-600" }, a.date, " • ", (students.find(s => s.id === a.studentId)?.name || "—"), " • ", (courses.find(c => c.id === a.courseId)?.title || "—")),
                  a.notes && React.createElement("div", { className: "text-sm mt-2" }, a.notes),
                  React.createElement("div", { className: "flex gap-2 mt-3" },
                    a.fileUrl && React.createElement("a", { className: "inline-flex items-center gap-1 text-sm underline", href: a.fileUrl, target: "_blank", rel: "noreferrer" }, React.createElement(Download, { className: "w-4 h-4" }), " Open"),
                    React.createElement(Button, { variant: "ghost", onClick: () => updateSample(a.id, { editing: true }) }, React.createElement(Edit2, { className: "w-4 h-4" }), " Edit"),
                    React.createElement(Button, { variant: "danger", onClick: () => deleteSample(a.id) }, React.createElement(Trash2, { className: "w-4 h-4" }), " Delete")
                  )
                )
              ))
            )
        ),
        React.createElement(Modal, { open: modalOpen, onClose: () => setModalOpen(false), title: "Add Work Sample" },
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Student"), React.createElement(Select, { value: form.studentId, onChange: e => setForm({ ...form, studentId: e.target.value }) }, students.map(s => React.createElement("option", { key: s.id, value: s.id }, s.name)))),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Course"), React.createElement(Select, { value: form.courseId, onChange: e => setForm({ ...form, courseId: e.target.value }) }, courses.map(c => React.createElement("option", { key: c.id, value: c.id }, c.title)))),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Date"), React.createElement(Input, { type: "date", value: form.date, onChange: e => setForm({ ...form, date: e.target.value }) })),
            React.createElement("div", { className: "md:col-span-2" }, React.createElement("label", { className: "text-sm" }, "Title"), React.createElement(Input, { value: form.title, onChange: e => setForm({ ...form, title: e.target.value }), placeholder: "e.g., Lab report: Density of water" })),
            React.createElement("div", { className: "md:col-span-2" }, React.createElement("label", { className: "text-sm" }, "Notes"), React.createElement(Textarea, { rows: 3, value: form.notes, onChange: e => setForm({ ...form, notes: e.target.value }), placeholder: "Rubric, evaluation, context…" })),
            React.createElement("div", { className: "md:col-span-2" },
              React.createElement("label", { className: "text-sm" }, "File (image, PDF, doc)"),
              React.createElement("input", { ref: fileInputRef, type: "file", accept: "image/*,application/pdf,.doc,.docx,.txt", onChange: onFile, className: "block w-full text-sm" }),
              form.fileName && React.createElement("div", { className: "text-xs text-gray-600 mt-1" }, "Selected: ", form.fileName)
            )
          ),
          React.createElement("div", { className: "mt-4 flex justify-end" }, React.createElement(Button, { onClick: submit }, React.createElement(Plus, { className: "w-4 h-4" }), " Save Sample"))
        )
      );
    }

    function ReportsTab({ state, goalsProgress, students, courses }) {
      const [selectedStudentId, setSelectedStudentId] = useState(students[0]?.id || "");
      const { total, core, atHome } = goalsProgress;
      const hoursByStudent = id => state.hours.filter(h => h.studentId === id);
      const samplesByStudent = id => state.samples.filter(a => a.studentId === id);
      function printStudentPortfolio(id) {
        const stu = students.find(s => s.id === id); if (!stu) return;
        const w = window.open("", "_blank");
        const yearLabel = state.meta.schoolYearLabel;
        const logs = hoursByStudent(id).sort((a,b) => new Date(a.date) - new Date(b.date));
        const byCourse = {};
        logs.forEach(l => {
          const c = courses.find(x => x.id === l.courseId)?.title || "(Course)";
          byCourse[c] = byCourse[c] || { total: 0, core: 0, atHome: 0, entries: [] };
          byCourse[c].total += l.minutes; if (l.isCore) byCourse[c].core += l.minutes; if (l.location === "Home") byCourse[c].atHome += l.minutes; byCourse[c].entries.push(l);
        });
        const samples = samplesByStudent(id);
        const style = "body { font-family: ui-sans-serif, system-ui, -apple-system; margin: 24px; } h1 { font-size: 20px; margin-bottom: 4px; } h2 { font-size: 16px; margin-top: 18px; } table { width: 100%; border-collapse: collapse; font-size: 12px; } th, td { border: 1px solid #ddd; padding: 6px; } .muted { color: #666; font-size: 11px; }";
        const mins = m => `${(m/60).toFixed(1)} h (${m} min)`;
        const html = `
          <html><head><title>Portfolio — ${stu.name}</title><style>${style}</style></head><body>
            <h1>Peaceful Fields Academy — Portfolio</h1>
            <div class="muted">${state.meta.location} • ${yearLabel}</div>
            <p><strong>Student:</strong> ${stu.name} &nbsp; <strong>Grade:</strong> ${stu.grade || "—"} &nbsp; <strong>DOB:</strong> ${stu.dob || "—"}</p>
            <h2>Yearly Progress (All Students)</h2>
            <p>Total: ${mins(total)} • Core: ${mins(core)} • At Home: ${mins(atHome)}</p>
            <h2>Hours by Course (${stu.name})</h2>
            <table><thead><tr><th>Course</th><th>Total</th><th>Core</th><th>At Home</th></tr></thead><tbody>
              ${Object.entries(byCourse).map(([k,v]) => `<tr><td>${k}</td><td>${mins(v.total)}</td><td>${mins(v.core)}</td><td>${mins(v.atHome)}</td></tr>`).join("")}
            </tbody></table>
            <h2>Work Samples (${samples.length})</h2>
            <ul>
              ${samples.map(s => `<li><strong>${s.title}</strong> — ${s.date} — ${courses.find(c => c.id === s.courseId)?.title || "(Course)"}${s.notes ? ": " + s.notes : ""}</li>`).join("")}
            </ul>
            <p class="muted">Generated on ${new Date().toLocaleString()}</p>
            <script>window.onload = () => window.print();</script>
          </body></html>`;
        w.document.write(html); w.document.close();
      }
      const allHours = state.hours.map(h => ({ student: students.find(s => s.id === h.studentId)?.name || "", course: courses.find(c => c.id === h.courseId)?.title || "", date: h.date, minutes: h.minutes, core: h.isCore ? "Yes" : "No", location: h.location }));
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: FolderOpen, title: "Reports & Export", subtitle: "Print portfolios, export data." }),
        React.createElement(Card, null,
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Student Portfolio"),
              React.createElement(Select, { value: selectedStudentId, onChange: e => setSelectedStudentId(e.target.value) }, students.map(s => React.createElement("option", { key: s.id, value: s.id }, s.name)))),
            React.createElement("div", { className: "flex items-end gap-2" },
              React.createElement(Button, { onClick: () => printStudentPortfolio(selectedStudentId) }, React.createElement(Printer, { className: "w-4 h-4" }), " Print Portfolio")
            )
          )
        ),
        React.createElement(Card, null,
          React.createElement("h3", { className: "font-semibold mb-2" }, "Quick Stats"),
          React.createElement("div", { className: "grid grid-cols-2 md:grid-cols-4 gap-3 text-sm" },
            React.createElement(Stat, { label: "Hours (All)", value: formatMinutes(goalsProgress.total) }),
            React.createElement(Stat, { label: "Core Minutes", value: formatMinutes(goalsProgress.core) }),
            React.createElement(Stat, { label: "At-Home Minutes", value: formatMinutes(goalsProgress.atHome) }),
            React.createElement(Stat, { label: "Work Samples", value: state.samples.length })
          )
        ),
        React.createElement(Card, null,
          React.createElement("h3", { className: "font-semibold mb-2" }, "Data Preview (Hours)"),
          React.createElement("div", { className: "overflow-x-auto" },
            React.createElement("table", { className: "w-full text-sm" },
              React.createElement("thead", null, React.createElement("tr", { className: "text-left border-b" },
                React.createElement("th", { className: "py-2" }, "Date"), React.createElement("th", null, "Student"), React.createElement("th", null, "Course"), React.createElement("th", null, "Minutes"), React.createElement("th", null, "Core"), React.createElement("th", null, "Location")
              )),
              React.createElement("tbody", null,
                allHours.slice(0, 20).map((r, i) => React.createElement("tr", { key: i, className: "border-b last:border-none" },
                  React.createElement("td", { className: "py-2" }, r.date), React.createElement("td", null, r.student), React.createElement("td", null, r.course), React.createElement("td", null, r.minutes), React.createElement("td", null, r.core), React.createElement("td", null, r.location)
                )),
                allHours.length === 0 && React.createElement("tr", null, React.createElement("td", { colSpan: 6, className: "text-center text-gray-600 py-6" }, "No data yet."))
              )
            )
          )
        )
      );
    }
    function Stat({ label, value }) { return React.createElement("div", { className: "border rounded-2xl p-3 bg-white" }, React.createElement("div", { className: "text-xs text-gray-600" }, label), React.createElement("div", { className: "text-lg font-semibold" }, value)); }

    function SettingsTab({ state, setState }) {
      const [m, setM] = useState({ ...state.meta });
      function save() { setState(s => ({ ...s, meta: { ...m, goals: { ...m.goals, total: Number(m.goals.total), core: Number(m.goals.core), atHome: Number(m.goals.atHome) } } })); }
      return React.createElement("div", { className: "space-y-4" },
        React.createElement(SectionTitle, { icon: Settings, title: "Settings", subtitle: "School identity, year, and goals." }),
        React.createElement(Card, null,
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Academy Name"), React.createElement(Input, { value: m.academyName, onChange: e => setM({ ...m, academyName: e.target.value }) })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Location"), React.createElement(Input, { value: m.location, onChange: e => setM({ ...m, location: e.target.value }) })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "School Year Label"), React.createElement(Input, { value: m.schoolYearLabel, onChange: e => setM({ ...m, schoolYearLabel: e.target.value }), placeholder: "e.g., 2025–2026" })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Year Start (MM/DD/YYYY)"), React.createElement(Input, { type: "date", value: m.yearStart?.slice(0,10) || "", onChange: e => setM({ ...m, yearStart: new Date(e.target.value).toISOString() }) }))
          )
        ),
        React.createElement(Card, null,
          React.createElement("h3", { className: "font-semibold mb-3" }, "Annual Goals (Minutes)"),
          React.createElement("div", { className: "grid grid-cols-1 md:grid-cols-3 gap-3" },
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Total (default: 60,000 min = 1000 h)"), React.createElement(Input, { type: "number", value: m.goals.total, onChange: e => setM({ ...m, goals: { ...m.goals, total: Number(e.target.value) } }) })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "Core (default: 36,000 min = 600 h)"), React.createElement(Input, { type: "number", value: m.goals.core, onChange: e => setM({ ...m, goals: { ...m.goals, core: Number(e.target.value) } }) })),
            React.createElement("div", null, React.createElement("label", { className: "text-sm" }, "At Home (default: 24,000 min = 400 h)"), React.createElement(Input, { type: "number", value: m.goals.atHome, onChange: e => setM({ ...m, goals: { ...m.goals, atHome: Number(e.target.value) } }) }))
          ),
          React.createElement("p", { className: "text-xs text-gray-600 mt-2" }, "Adjust as needed to fit your homeschool plan."),
          React.createElement("div", { className: "mt-3" }, React.createElement(Button, { onClick: save }, React.createElement(Save, { className: "w-4 h-4" }), " Save Settings"))
        ),
        React.createElement(Card, null,
          React.createElement("h3", { className: "font-semibold mb-2" }, "Backup & Restore"),
          React.createElement("p", { className: "text-sm text-gray-700" },
            "Use the header buttons to export a JSON backup and restore later. Your data is stored locally in your browser and not uploaded anywhere unless you export it."
          )
        )
      );
    }

    function App() {
      const [state, setState] = usePersistentState();
      const [tab, setTab] = useState("dashboard");
      const [activeStudentId, setActiveStudentId] = useState("");
      const { total, core, atHome } = useGoalsProgress(state, activeStudentId, state.meta.yearStart);
      const students = state.students;
      const courses = state.courses;
      function addStudent(stu){ setState(s => ({...s, students:[...s.students,{id:uid("stu"),...stu}]})); }
      function updateStudent(id,patch){ setState(s => ({...s, students:s.students.map(x=>x.id===id?{...x,...patch}:x)})); }
      function deleteStudent(id){ setState(s => ({...s, students:s.students.filter(x=>x.id!==id), hours:s.hours.filter(h=>h.studentId!==id), samples:s.samples.filter(a=>a.studentId!==id)})); if(activeStudentId===id) setActiveStudentId(""); }
      function addCourse(c){ setState(s => ({...s, courses:[...s.courses,{id:uid("cou"),...c}]})); }
      function updateCourse(id,patch){ setState(s => ({...s, courses:s.courses.map(x=>x.id===id?{...x,...patch}:x)})); }
      function deleteCourse(id){ setState(s => ({...s, courses:s.courses.filter(x=>x.id!==id), hours:s.hours.filter(h=>h.courseId!==id), samples:s.samples.filter(a=>a.courseId!==id)})); }
      function addHour(h){ setState(s => ({...s, hours:[...s.hours,{id:uid("log"),...h}]})); }
      function updateHour(id,patch){ setState(s => ({...s, hours:s.hours.map(x=>x.id===id?{...x,...patch}:x)})); }
      function deleteHour(id){ setState(s => ({...s, hours:s.hours.filter(x=>x.id!==id)})); }
      function addSample(a){ setState(s => ({...s, samples:[...s.samples,{id:uid("smp"),...a}]})); }
      function updateSample(id,patch){ setState(s => ({...s, samples:s.samples.map(x=>x.id===id?{...x,...patch}:x)})); }
      function deleteSample(id){ setState(s => ({...s, samples:s.samples.filter(x=>x.id!==id)})); }
      function exportData(){ downloadFile(`pfa_backup_${Date.now()}.json`, JSON.stringify(state,null,2)); }
      function importData(file){ const r=new FileReader(); r.onload=e=>{ try{ const obj=JSON.parse(e.target.result); if(obj&&obj.meta&&obj.students&&obj.courses){ setState(obj); } else alert("Invalid backup file."); } catch{ alert("Could not parse JSON."); } }; r.readAsText(file); }
      function exportHoursCSV(){ const rows=state.hours.map(h=>({ id:h.id, student:(students.find(s=>s.id===h.studentId)?.name)||"", course:(courses.find(c=>c.id===h.courseId)?.title)||"", date:h.date, minutes:h.minutes, hours:(Number(h.minutes)/60).toFixed(2), isCore:h.isCore?"Yes":"No", location:h.location, notes:h.notes||"" })); const csv=toCSV(rows); const blob=new Blob([csv],{type:"text/csv"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=`pfa_hours_${Date.now()}.csv`; document.body.appendChild(a); a.click(); a.remove(); }
      function exportSamplesCSV(){ const rows=state.samples.map(a=>({ id:a.id, student:(students.find(s=>s.id===a.studentId)?.name)||"", course:(courses.find(c=>c.id===a.courseId)?.title)||"", date:a.date, title:a.title, fileName:a.fileName||"", fileUrl:a.fileUrl||"", notes:a.notes||"" })); const csv=toCSV(rows); const blob=new Blob([csv],{type:"text/csv"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=`pfa_samples_${Date.now()}.csv`; document.body.appendChild(a); a.click(); a.remove(); }

      return React.createElement("div", { className: "min-h-screen bg-gray-50" },
        React.createElement("header", { className: "sticky top-0 z-40 bg-white/90 backdrop-blur border-b" },
          React.createElement("div", { className: "max-w-7xl mx-auto px-4 py-3 flex items-center justify-between" },
            React.createElement("div", { className: "flex items-center gap-3" },
              React.createElement("div", { className: "w-10 h-10 rounded-2xl bg-blue-600 text-white grid place-content-center font-semibold" }, "PFA"),
              React.createElement("div", null,
                React.createElement("h1", { className: "text-lg font-semibold" }, state.meta.academyName),
                React.createElement("p", { className: "text-xs text-gray-600" }, state.meta.location, " • ", state.meta.schoolYearLabel)
              )
            ),
            React.createElement("div", { className: "flex items-center gap-2" },
              React.createElement(Button, { variant: "ghost", onClick: exportData }, React.createElement(Save, { className: "w-4 h-4" }), " Backup"),
              React.createElement("label", { className: "inline-flex items-center gap-2 px-3 py-2 rounded-xl text-sm font-medium border bg-white cursor-pointer" },
                React.createElement(Upload, { className: "w-4 h-4" }), " Restore",
                React.createElement("input", { type: "file", className: "hidden", accept: "application/json", onChange: e => e.target.files?.[0] && importData(e.target.files[0]) })
              )
            )
          )
        ),
        React.createElement("main", { className: "max-w-7xl mx-auto p-4" },
          React.createElement("div", { className: "grid grid-cols-1 lg:grid-cols-[220px_1fr] gap-4" },
            React.createElement(Card, { className: "p-0" },
              React.createElement("div", { className: "p-3 border-b" },
                React.createElement("div", { className: "text-sm text-gray-600 mb-1" }, "Active Student"),
                React.createElement(Select, { value: "", onChange: () => {} },
                  React.createElement("option", { value: "" }, "All Students")
                )
              ),
              React.createElement("nav", { className: "p-2" },
                React.createElement(SideTab, { icon: LayoutDashboard, label: "Dashboard", value: "dashboard", tab: "dashboard", setTab: () => {} }),
                React.createElement(SideTab, { icon: User, label: "Students", value: "students", tab: "", setTab: () => {} }),
                React.createElement(SideTab, { icon: BookOpen, label: "Courses", value: "courses", tab: "", setTab: () => {} }),
                React.createElement(SideTab, { icon: Clock, label: "Log Hours", value: "hours", tab: "", setTab: () => {} }),
                React.createElement(SideTab, { icon: Images, label: "Work Samples", value: "samples", tab: "", setTab: () => {} }),
                React.createElement(SideTab, { icon: FolderOpen, label: "Reports & Export", value: "reports", tab: "", setTab: () => {} }),
                React.createElement(SideTab, { icon: Settings, label: "Settings", value: "settings", tab: "", setTab: () => {} })
              )
            )
          )
        ),
        React.createElement("footer", { className: "max-w-7xl mx-auto p-4 text-center text-xs text-gray-500" },
          "Peaceful Fields Academy • Kansas City, Missouri • Data stored locally in your browser"
        )
      );
    }

    const root = createRoot(document.getElementById("root"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
