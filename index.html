<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Peaceful Academy â€“ Kansas City, Missouri v1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <style>
    body { padding-top: 3.25rem; }
    .menu-toggle { cursor: pointer; }
    .navbar-menu { display: none; }
    .navbar-menu.is-active { display: block; }
    @media (min-width: 1024px) {
      .navbar-menu { display: flex !important; }
    }
  </style>
</head>
<body>
  <!-- Navbar with Hamburger -->
  <nav class="navbar is-primary is-fixed-top" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
      <a class="navbar-item" href="#">Peaceful Fields Academy</a>
      <a role="button" class="navbar-burger menu-toggle" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>
    <div id="navMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" onclick="showSection('dashboard')">Dashboard</a>
        <a class="navbar-item" onclick="showSection('students')">Students</a>
        <a class="navbar-item" onclick="showSection('courses')">Courses</a>
        <a class="navbar-item" onclick="showSection('logs')">Hours Log</a>
        <a class="navbar-item" onclick="showSection('portfolio')">Portfolio</a>
        <a class="navbar-item" onclick="showSection('reports')">Reports</a>
        <a class="navbar-item" onclick="showSection('transcript')">Transcript</a>
        <a class="navbar-item" onclick="showSection('diploma')">Diploma</a>
      </div>
    </div>
  </nav>

  <!-- Sections -->
  <section id="dashboard" class="section">
    <div class="container">
      <h1 class="title">Dashboard</h1>
      <div id="stats"></div>
    </div>
  </section>

  <section id="students" class="section is-hidden">
    <div class="container">
      <h1 class="title">Students</h1>
      <form id="studentForm" netlify>
        <div class="field"><label class="label">Name</label><input class="input" name="name" required></div>
        <div class="field"><label class="label">DOB</label><input class="input" type="date" name="dob"></div>
        <button class="button is-link" type="submit">Add Student</button>
      </form>
    </div>
  </section>

  <section id="courses" class="section is-hidden">
    <div class="container">
      <h1 class="title">Courses</h1>
      <form id="courseForm" netlify>
        <div class="field"><label class="label">Title</label><input class="input" name="title" required></div>
        <div class="field"><label class="label">Subject</label><input class="input" name="subject"></div>
        <button class="button is-link" type="submit">Add Course</button>
      </form>
    </div>
  </section>

  <section id="logs" class="section is-hidden">
    <div class="container">
      <h1 class="title">Hours Log</h1>
      <form id="logForm" netlify>
        <div class="field"><label class="label">Date</label><input class="input" type="date" name="date" required></div>
        <div class="field"><label class="label">Hours</label><input class="input" type="number" step="0.25" name="hours" required></div>
        <button class="button is-link" type="submit">Add Log</button>
      </form>
    </div>
  </section>

  <section id="portfolio" class="section is-hidden">
    <div class="container">
      <h1 class="title">Portfolio</h1>
      <form id="portfolioForm" netlify>
        <div class="field"><label class="label">Title</label><input class="input" name="title" required></div>
        <div class="field"><label class="label">Description</label><textarea class="textarea" name="description"></textarea></div>
        <button class="button is-link" type="submit">Add Portfolio Item</button>
      </form>
    </div>
  </section>

  <section id="reports" class="section is-hidden">
    <div class="container">
      <h1 class="title">Reports</h1>
      <button class="button is-info" onclick="loadReports()">Generate Yearly Report</button>
      <pre id="reportOutput"></pre>
    </div>
  </section>

  <section id="transcript" class="section is-hidden">
    <div class="container">
      <h1 class="title">Transcript Generator</h1>
      <button class="button is-info" onclick="generateTranscript()">Print Transcript</button>
      <pre id="transcriptOutput"></pre>
    </div>
  </section>

  <section id="diploma" class="section is-hidden">
    <div class="container">
      <h1 class="title">Diploma Generator</h1>
      <button class="button is-primary" onclick="generateDiploma()">Print Diploma</button>
    </div>
  </section>

  <!-- Scripts -->
  <script>
    // hamburger toggle
    document.querySelector('.menu-toggle').addEventListener('click', () => {
      document.getElementById('navMenu').classList.toggle('is-active');
    });

    function showSection(id) {
      document.querySelectorAll('section').forEach(sec => sec.classList.add('is-hidden'));
      document.getElementById(id).classList.remove('is-hidden');
      // collapse nav on mobile
      document.getElementById('navMenu').classList.remove('is-active');
    }

    async function refreshStats() {
      try {
        const r = await fetch('/.netlify/functions/db?action=stats');
        const j = await r.json();
        document.getElementById('stats').textContent = JSON.stringify(j.stats,null,2);
      } catch (e) {
        document.getElementById('stats').textContent = 'Error: '+e;
      }
    }
    async function loadReports() {
      const r = await fetch('/.netlify/functions/api/reports/yearly');
      const j = await r.json();
      document.getElementById('reportOutput').textContent = JSON.stringify(j.rows||j,null,2);
    }
    function generateTranscript() {
      document.getElementById('transcriptOutput').textContent = "Transcript PDF would be generated here.";
    }
    function generateDiploma() {
      window.print();
    }
    refreshStats();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>