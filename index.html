<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peaceful Academy (KC, MO) — Homeschool Records</title>

  <link rel="manifest" href="/manifest.webmanifest" />
  <meta name="theme-color" content="#0b1226" />

  <link rel="stylesheet" href="/assets/reports.css" />
  <style>
    :root{
      --bg:#0b1226; --panel:#121a33; --text:#e7ecff; --muted:#98a1c0;
      --border:#1b2544;
    }
    :root[data-theme="light"]{
      --bg:#f6f7fb; --panel:#ffffff; --text:#0b1226; --muted:#4b5675;
      --border:#e1e6f4;
    }
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Arial}
    header{padding:16px;border-bottom:1px solid var(--border)}
    .brand{margin:0 0 8px 0}
    nav a{display:inline-block;margin-right:10px;color:var(--muted);text-decoration:none;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:var(--panel)}
    nav a.active{color:var(--text);border-color:#5b8cff}
    main{max-width:1100px;margin:20px auto;padding:0 16px}
    [hidden]{display:none !important}
  </style>

  <!-- Theme handling -->
  <script>
    (function(){
      const THEME_KEY = 'appTheme';
      const LIGHT_BG = '#f6f7fb';
      const DARK_BG = '#0b1226';
      const themeMeta = document.querySelector('meta[name="theme-color"]');

      function getStoredTheme(){
        try { return localStorage.getItem(THEME_KEY) || 'system'; } catch { return 'system'; }
      }
      function setStoredTheme(val){
        try { localStorage.setItem(THEME_KEY, val); } catch {}
      }
      const mql = window.matchMedia('(prefers-color-scheme: dark)');
      function applyTheme(mode){
        const root = document.documentElement;
        let effective = mode;
        if(mode === 'system') effective = mql.matches ? 'dark' : 'light';
        if(effective === 'light') {
          root.setAttribute('data-theme','light');
          if(themeMeta) themeMeta.setAttribute('content', LIGHT_BG);
        } else {
          root.removeAttribute('data-theme');
          if(themeMeta) themeMeta.setAttribute('content', DARK_BG);
        }
      }
      function initTheme(){
        const mode = getStoredTheme();
        applyTheme(mode);
        if(mql.addEventListener){
          mql.addEventListener('change', () => { if(getStoredTheme()==='system') applyTheme('system'); });
        } else if(mql.addListener){
          mql.addListener(() => { if(getStoredTheme()==='system') applyTheme('system'); });
        }
        document.addEventListener('DOMContentLoaded', () => {
          const select = document.getElementById('themeSelect');
          if(select){
            select.value = mode;
            select.addEventListener('change', () => { const v = select.value; setStoredTheme(v); applyTheme(v); });
          }
        });
      }
      initTheme();
    }());
  </script>
</head>
<body>
  <header>
    <h1 class="brand">Peaceful Academy • Kansas City, MO</h1>
    <nav id="mainNav" class="pill-nav">
      <a href="/#dashboard" data-link="dashboard">Dashboard</a>
      <a href="/#students" data-link="students">Students</a>
      <a href="/#courses" data-link="courses">Courses</a>
      <a href="/#log" data-link="log">Log Hours</a>
      <a href="/#reports" data-link="reports">Reports</a>
      <a href="/#transcript" data-link="transcript">Transcript</a>
      <a href="/#diploma" data-link="diploma">Diploma</a>
      <a href="/#settings" data-link="settings">Settings</a>
      <a href="/#help" data-link="help">Help</a>
    </nav>
  </header>

  <main>
    <!-- DASHBOARD -->
    <section id="dashboardView" data-route="dashboard">
      <div class="card">
        <h2>Dashboard</h2>
        <p>Welcome to Peaceful Academy. Use the navigation to get started.</p>
      </div>
    </section>

    <!-- STUDENTS -->
    <section id="studentsView" data-route="students" hidden>
      <div class="card"><h2>Students</h2><p>Students view content…</p></div>
    </section>

    <!-- COURSES -->
    <section id="coursesView" data-route="courses" hidden>
      <div class="card"><h2>Courses</h2><p>Courses view content…</p></div>
    </section>

    <!-- LOG HOURS -->
    <section id="logView" data-route="log" hidden>
      <div class="card"><h2>Log Hours</h2><p>Log Hours view content…</p></div>
    </section>

    <!-- REPORTS (UPDATED WITH NON-CORE) -->
    <section id="reportsView" data-route="reports" hidden>
      <section class="card">
        <h2>Annual Compliance Report</h2>

        <div class="grid grid-3">
          <label class="field">
            <span>Student</span>
            <select id="studentSelect" aria-label="Student"></select>
          </label>

          <label class="field">
            <span>Academic Year</span>
            <select id="yearSelect" aria-label="Academic Year"></select>
          </label>

          <label class="field">
            <span>Group By</span>
            <select id="groupBySelect" aria-label="Group By">
              <option value="subject">Subject</option>
              <option value="month">Month</option>
              <option value="location">Location</option>
            </select>
          </label>
        </div>

        <div class="grid grid-2 metrics">
          <div class="metric">
            <div class="metric-head">
              <span>Total Hours (goal 1000)</span>
              <strong id="totalHours">0</strong>
            </div>
            <div class="bar"><span id="totalBar" style="width:0%"></span></div>
          </div>

          <div class="metric">
            <div class="metric-head">
              <span>Core Hours (goal 600)</span>
              <strong id="coreHours">0</strong>
            </div>
            <div class="bar"><span id="coreBar" style="width:0%"></span></div>
          </div>

          <div class="metric">
            <div class="metric-head">
              <span>Core @ Home (goal 400)</span>
              <strong id="coreHomeHours">0</strong>
            </div>
            <div class="bar"><span id="coreHomeBar" style="width:0%"></span></div>
          </div>

          <!-- NEW: Non-Core -->
          <div class="metric">
            <div class="metric-head">
              <span>Non-Core Hours (goal 400)</span>
              <strong id="nonCoreHours">0</strong>
            </div>
            <div class="bar"><span id="nonCoreBar" style="width:0%"></span></div>
          </div>
        </div>

        <div class="actions">
          <button id="printBtn" class="btn">Print Report</button>
        </div>
      </section>

      <section class="card">
        <h3>Hours</h3>
        <div id="hoursTableWrap"></div>
      </section>
    </section>

    <!-- TRANSCRIPT -->
    <section id="transcriptView" data-route="transcript" hidden>
      <div class="card"><h2>Transcript</h2><p>Transcript view content…</p></div>
    </section>

    <!-- DIPLOMA -->
    <section id="diplomaView" data-route="diploma" hidden>
      <div class="card"><h2>Diploma</h2><p>Diploma view content…</p></div>
    </section>

    <!-- SETTINGS -->
    <section id="settingsView" data-route="settings" hidden>
      <div class="card">
        <h2>Settings</h2>
        <div class="grid grid-3">
          <label class="field">
            <span>Theme</span>
            <select id="themeSelect" aria-label="Theme">
              <option value="system">System</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </label>
        </div>
      </div>
    </section>

    <!-- HELP -->
    <section id="helpView" data-route="help" hidden>
      <div class="card"><h2>Help</h2><p>Help view content…</p></div>
    </section>
  </main>

  <!-- Tiny hash router -->
  <script>
    (function () {
      const routes = Array.from(document.querySelectorAll('[data-route]'));
      const links  = Array.from(document.querySelectorAll('nav a[data-link]'));

      function render() {
        const key = (location.hash || '#dashboard').slice(1);
        routes.forEach(s => { s.hidden = (s.dataset.route !== key); });
        links.forEach(a => { a.classList.toggle('active', a.dataset.link === key); });
      }

      window.addEventListener('hashchange', render);
      window.addEventListener('DOMContentLoaded', render);
    }());
  </script>

  <!-- Reports logic -->
  <script type="module" src="/assets/reports.js"></script>
</body>
</html>

